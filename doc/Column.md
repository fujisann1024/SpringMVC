# 調査

<details>

<summary>なぜ外部キーが業務アプリケーションで避けられるのか</summary>

- FK は読み取り最適化のヒントにもなる一方、書き込みでは余分なロックが入りがち
- 論理削除と相性が悪い
- 大量取り込み時は外部キー削除することも多いためそもそも制約をつけない

</details>

<details>

<summary>主キーはUUIDと発番テーブルからの発行のメリット・デメリット比較</summary>

- UUID(v7)
  - メリット
    - 中央の採番点が不要。マイクロサービス/マルチリージョンで衝突なく発行できる。
    - 順番が読めない ID は列挙されにくい
  - デメリット
    - uuid は 128bit=16B。bigint(8B)等の連番よりインデックス/JOIN が重くなりがち。
- 発番テーブル
  - メリット
    - 数値は 8B 以下でコンパクト、生成が安い（乱数不要）。インデックス/JOIN 効率がよい。
  - デメリット
    - アプリ側の「発番テーブル更新（MAX+1）」はロック競合の温床。DB のネイティブシーケンスなら多ユーザ安全だが、単一 DB には依存する。
    - 中央発番点を越境すると待ち・故障点に。
    - 連番は URL 等で列挙攻撃の的になりやすい

UUID のほうが現在のシステムの流れ的にあってそう

</details>
